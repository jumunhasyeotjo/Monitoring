{
  "editable": true,
  "panels": [
    {
      "datasource": "Prometheus",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 0 },
      "targets": [
        { "expr": "sum(rate(http_server_requests_seconds_count{job=~\".*$service.*\"}[1m])) OR on() vector(0)", "legendFormat": "RPS" }
      ],
      "title": "Request Rate (RPS)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 0 },
      "targets": [
        { "expr": "(sum(rate(http_server_requests_seconds_count{job=~\".*$service.*\", status=~\"5..\"}[1m])) / sum(rate(http_server_requests_seconds_count{job=~\".*$service.*\"}[1m]))) * 100 OR on() vector(0)" }
      ],
      "title": "Error Rate (%)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "ms" } },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 0 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket{job=~\".*$service.*\"}[1m])) by (le)) * 1000",
          "legendFormat": "P95"
        }
      ],
      "title": "Duration (Latency)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 8 },
      "targets": [
        { "expr": "sum(hikaricp_connections_active{job=~\".*$service.*\"}) OR on() vector(0)", "legendFormat": "Active" },
        { "expr": "sum(hikaricp_connections_max{job=~\".*$service.*\"}) OR on() vector(0)", "legendFormat": "Max" }
      ],
      "title": "DB Connection Pool (HikariCP)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 16 },
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count{job=~\".*$service.*\", status=~\"2..\"}[1m])) OR on() vector(0)",
          "legendFormat": "TPS (Success)"
        }
      ],
      "title": "Transactions Per Second (TPS)",
      "type": "timeseries"
    }
  ],
  "templating": {
    "list": [
      {
        "datasource": "Prometheus",
        "definition": "label_values(up{job=~\"jumunhasyeo.*\"}, container_name)",
        "name": "service",
        "query": "label_values(up{job=~\"jumunhasyeo.*\"}, container_name)",
        "refresh": 1,
        "type": "query",
        "label": "Service Name"
      }
    ]
  },
  "title": "Level 2 - Service RED Dashboard",
  "uid": "l2-service-view-clean"
}